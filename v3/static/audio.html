<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MUD Audio ‚Äî Test Console</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Consolas', 'Courier New', monospace;
            background: #1a1a2e;
            color: #e0e0e0;
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            color: #0f3460;
            background: #e0e0e0;
            padding: 8px 16px;
            border-radius: 4px;
            margin-bottom: 16px;
            font-size: 1.1em;
        }

        h2 {
            color: #16c79a;
            margin: 16px 0 8px;
            font-size: 0.95em;
            border-bottom: 1px solid #333;
            padding-bottom: 4px;
        }

        .panel {
            background: #16213e;
            border: 1px solid #0f3460;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 12px;
        }

        .row {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 6px;
        }

        label {
            font-size: 0.85em;
            color: #888;
            min-width: 70px;
        }

        input[type="text"],
        input[type="number"],
        input[type="range"] {
            background: #0f3460;
            color: #e0e0e0;
            border: 1px solid #333;
            padding: 4px 8px;
            border-radius: 3px;
            font-family: inherit;
            font-size: 0.85em;
        }

        input[type="text"] {
            flex: 1;
            min-width: 200px;
        }

        input[type="number"] {
            width: 70px;
        }

        input[type="range"] {
            flex: 1;
            min-width: 100px;
        }

        button {
            background: #0f3460;
            color: #16c79a;
            border: 1px solid #16c79a;
            padding: 5px 14px;
            border-radius: 3px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.85em;
            transition: background 0.15s;
        }

        button:hover {
            background: #16c79a;
            color: #0f3460;
        }

        button.danger {
            border-color: #e74c3c;
            color: #e74c3c;
        }

        button.danger:hover {
            background: #e74c3c;
            color: #fff;
        }

        #log {
            background: #0a0a1a;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 10px;
            height: 180px;
            overflow-y: auto;
            font-size: 0.8em;
            line-height: 1.5;
            white-space: pre-wrap;
            word-break: break-all;
        }

        #log .ok {
            color: #16c79a;
        }

        #log .err {
            color: #e74c3c;
        }

        #log .info {
            color: #6c9bff;
        }

        #log .warn {
            color: #f39c12;
        }

        #stateDisplay {
            font-size: 0.8em;
            color: #999;
            background: #0a0a1a;
            padding: 8px;
            border-radius: 4px;
            white-space: pre;
        }

        .note {
            font-size: 0.78em;
            color: #666;
            margin-top: 4px;
        }

        /* sample buttons grid */
        .samples {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .samples button {
            font-size: 0.78em;
            padding: 3px 10px;
        }
    </style>
</head>

<body>

    <h1>üîä MUD Audio Engine ‚Äî Test Console</h1>

    <!-- ‚îÄ‚îÄ‚îÄ Play / Stop ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="panel">
        <h2>‚ñ∂ Play / Stop</h2>
        <div class="row">
            <label>URL:</label>
            <input type="text" id="sndUrl" placeholder="https://... ou /static/sounds/file.ogg"
                value="https://actions.google.com/sounds/v1/alarms/beep_short.ogg">
        </div>
        <div class="row">
            <label>Loop:</label>
            <input type="number" id="sndLoop" value="0" min="0" max="1" style="width:50px">
            <label>Pan:</label>
            <input type="number" id="sndPan" value="0" min="-100" max="100" style="width:60px">
            <label>Vol:</label>
            <input type="number" id="sndVol" value="100" min="0" max="100" style="width:60px">
        </div>
        <div class="row">
            <button onclick="doPlay()">Play</button>
            <button onclick="doPlayLooped()">Play Looped</button>
            <button onclick="doPlayDelay()">Play Delay (1s)</button>
            <button onclick="doPlayDelayLooped()">Play Delay Looped (1s)</button>
        </div>
        <div class="row">
            <label>Stop ID:</label>
            <input type="number" id="stopId" value="0" min="0" style="width:60px">
            <button class="danger" onclick="doStop()">Stop</button>
            <button class="danger" onclick="MudAudio.stop(0); log('Todos os sons parados', 'warn')">Stop All</button>
        </div>
        <p class="note">ID=0 para tudo. Samples de teste gratuitos do Google Actions.</p>

        <h2>üéµ Samples r√°pidos</h2>
        <div class="samples">
            <button onclick="quickPlay('https://actions.google.com/sounds/v1/alarms/beep_short.ogg')">Beep</button>
            <button
                onclick="quickPlay('https://actions.google.com/sounds/v1/water/waves_crashing_on_rock_beach.ogg')">Waves</button>
            <button
                onclick="quickPlay('https://actions.google.com/sounds/v1/ambiences/forest_with_birds.ogg')">Forest</button>
            <button onclick="quickPlay('https://actions.google.com/sounds/v1/doors/wood_door_close.ogg')">Door</button>
            <button onclick="quickPlay('https://actions.google.com/sounds/v1/weapons/sharp_shing.ogg')">Sword</button>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ Sound Registry ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="panel">
        <h2>üì¶ Sound Registry (sounds.json)</h2>
        <div class="row">
            <button onclick="doLoadRegistry()">Carregar Registry</button>
            <span id="registryStatus" style="font-size:0.8em; color:#666;">n√£o carregado</span>
        </div>
        <div class="row">
            <label>Nome:</label>
            <select id="registrySelect"
                style="flex:1; background:#0f3460; color:#e0e0e0; border:1px solid #333; padding:4px; border-radius:3px; font-family:inherit;">
                <option value="">‚Äî carregue o registry primeiro ‚Äî</option>
            </select>
        </div>
        <div class="row">
            <label>ou texto:</label>
            <input type="text" id="registryName" placeholder="combat_hit" style="flex:1;">
        </div>
        <div class="row">
            <button onclick="doPlayByName()">playByName</button>
            <button onclick="doPlayByNameLooped()">playByName (loop)</button>
            <button onclick="doResolve()">resolve (s√≥ URL)</button>
        </div>
        <p class="note">Coloque arquivos .ogg/.mp3/.wav em <code>/static/sounds/</code> e mapeie em
            <code>sounds.json</code>.</p>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ Volume / Mute ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="panel">
        <h2>üîà Volume / Mute</h2>
        <div class="row">
            <label>Master:</label>
            <input type="range" id="masterVol" min="0" max="100" value="100" oninput="doVolume(this.value)">
            <span id="masterVolLabel">100</span>
        </div>
        <div class="row">
            <button onclick="doToggleMute()">Toggle Mute (Ctrl+F12)</button>
            <button onclick="doVolumeDown()">Vol ‚àí5</button>
            <button onclick="doVolumeUp()">Vol +5</button>
        </div>
        <div class="row">
            <label>slideVol ID:</label>
            <input type="number" id="slideVolId" value="1" min="1" style="width:50px">
            <label>Target:</label>
            <input type="number" id="slideVolTarget" value="30" min="0" max="100" style="width:60px">
            <label>ms:</label>
            <input type="number" id="slideVolMs" value="2000" min="100" style="width:70px">
            <button onclick="doSlideVol()">Slide Vol</button>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ Pan ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="panel">
        <h2>üéß Pan Est√©reo</h2>
        <div class="row">
            <label>Default Pan:</label>
            <input type="range" id="defaultPan" min="-100" max="100" value="0" oninput="doPan(this.value)">
            <span id="defaultPanLabel">0</span>
        </div>
        <div class="row">
            <label>Pan ID:</label>
            <input type="number" id="panId" value="1" min="1" style="width:50px">
            <label>Val:</label>
            <input type="number" id="panVal" value="0" min="-100" max="100" style="width:60px">
            <button onclick="doPanId()">Set Pan</button>
        </div>
        <div class="row">
            <label>slidePan ID:</label>
            <input type="number" id="slidePanId" value="1" min="1" style="width:50px">
            <label>Target:</label>
            <input type="number" id="slidePanTarget" value="100" min="-100" max="100" style="width:60px">
            <label>ms:</label>
            <input type="number" id="slidePanMs" value="2000" min="100" style="width:70px">
            <button onclick="doSlidePan()">Slide Pan</button>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ Fadeout ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="panel">
        <h2>üîª Fadeout</h2>
        <div class="row">
            <label>ID:</label>
            <input type="number" id="fadeId" value="1" min="1" style="width:50px">
            <label>ms:</label>
            <input type="number" id="fadeMs" value="2000" min="100" style="width:70px">
            <button onclick="doFadeout()">Fadeout</button>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ Pitch / Freq ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="panel">
        <h2>üéº Pitch / Freq</h2>
        <div class="row">
            <label>ID:</label>
            <input type="number" id="pitchId" value="1" min="1" style="width:50px">
            <label>Val (100=normal):</label>
            <input type="number" id="pitchVal" value="100" min="10" max="400" style="width:70px">
            <button onclick="doPitch()">Set Pitch</button>
        </div>
        <div class="row">
            <label>slidePitch ID:</label>
            <input type="number" id="slidePitchId" value="1" min="1" style="width:50px">
            <label>Target:</label>
            <input type="number" id="slidePitchTarget" value="200" min="10" max="400" style="width:70px">
            <label>ms:</label>
            <input type="number" id="slidePitchMs" value="2000" min="100" style="width:70px">
            <button onclick="doSlidePitch()">Slide Pitch</button>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ Estado / Log ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="panel">
        <h2>üìã Estado</h2>
        <div class="row">
            <button onclick="refreshState()">Refresh</button>
            <button class="danger" onclick="MudAudio.free(); log('free() ‚Äî tudo liberado','warn'); refreshState()">Free
                (Reset)</button>
        </div>
        <div id="stateDisplay">‚Äî</div>
    </div>

    <div class="panel">
        <h2>üìù Log</h2>
        <div id="log"></div>
    </div>

    <script src="/static/js/audio.js"></script>
    <script>
        const $ = id => document.getElementById(id);
        const logEl = $('log');

        function log(msg, cls = 'ok') {
            const ts = new Date().toLocaleTimeString('pt-BR');
            logEl.innerHTML += `<span class="${cls}">[${ts}] ${msg}</span>\n`;
            logEl.scrollTop = logEl.scrollHeight;
        }

        function refreshState() {
            const s = MudAudio.getState();
            const active = MudAudio.getActiveSounds();
            let txt = `Volume: ${s.volume}  |  Muted: ${s.muted}  |  Pan: ${s.defaultPan}  |  Freq: ${s.defaultFreq}\n`;
            txt += `Context: ${s.contextState}  |  Ativos: ${s.activeSounds}  |  Cache: ${s.cachedBuffers}\n`;
            txt += `Registry: ${s.registryLoaded ? s.registrySize + ' sons' : 'n√£o carregado'}\n`;
            if (active.length) {
                txt += `\nSons ativos:\n`;
                active.forEach(a => {
                    txt += `  #${a.id}  vol=${a.volume}  pan=${a.pan}  rate=${a.rate}  loop=${a.loop}  playing=${a.playing}\n`;
                });
            }
            $('stateDisplay').textContent = txt;
        }

        // ‚îÄ‚îÄ Handlers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

        async function doPlay() {
            try {
                const id = await MudAudio.play(
                    $('sndUrl').value,
                    parseInt($('sndLoop').value),
                    parseInt($('sndPan').value),
                    parseInt($('sndVol').value)
                );
                log(`play ‚Üí id=${id}`);
                refreshState();
            } catch (e) { log(e.message, 'err'); }
        }

        async function doPlayLooped() {
            try {
                const id = await MudAudio.playLooped($('sndUrl').value);
                log(`playLooped ‚Üí id=${id}`);
                refreshState();
            } catch (e) { log(e.message, 'err'); }
        }

        async function doPlayDelay() {
            try {
                log('playDelay agendado (1000ms)...', 'info');
                const id = await MudAudio.playDelay(
                    $('sndUrl').value, 1000,
                    parseInt($('sndPan').value),
                    parseInt($('sndVol').value)
                );
                log(`playDelay ‚Üí id=${id}`);
                refreshState();
            } catch (e) { log(e.message, 'err'); }
        }

        async function doPlayDelayLooped() {
            try {
                log('playDelayLooped agendado (1000ms)...', 'info');
                const id = await MudAudio.playDelayLooped(
                    $('sndUrl').value, 1000,
                    parseInt($('sndPan').value),
                    parseInt($('sndVol').value)
                );
                log(`playDelayLooped ‚Üí id=${id}`);
                refreshState();
            } catch (e) { log(e.message, 'err'); }
        }

        function doStop() {
            const id = parseInt($('stopId').value);
            MudAudio.stop(id);
            log(`stop(${id})`, 'warn');
            refreshState();
        }

        async function quickPlay(url) {
            try {
                const id = await MudAudio.play(url);
                log(`quickPlay ‚Üí id=${id}  (${url.split('/').pop()})`);
                refreshState();
            } catch (e) { log(e.message, 'err'); }
        }

        // ‚îÄ‚îÄ Volume ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

        function doVolume(v) {
            v = parseInt(v);
            $('masterVolLabel').textContent = v;
            MudAudio.volume(v);
            refreshState();
        }

        function doToggleMute() {
            MudAudio.toggleMute();
            const s = MudAudio.getState();
            $('masterVol').value = s.muted ? 0 : s.volume;
            $('masterVolLabel').textContent = s.muted ? 'MUTE' : s.volume;
            log(`toggleMute ‚Üí muted=${s.muted}`, s.muted ? 'warn' : 'ok');
            refreshState();
        }

        function doVolumeDown() {
            if (MudAudio.isMuted()) { log('Sons desativados!', 'warn'); return; }
            const cur = MudAudio.getVolume();
            if (cur <= 0) { log('Volume j√° est√° em 0.', 'warn'); return; }
            const nv = Math.max(0, cur - 5);
            MudAudio.volume(nv);
            $('masterVol').value = nv;
            $('masterVolLabel').textContent = nv;
            log(`volume ‚Üí ${nv}`);
            refreshState();
        }

        function doVolumeUp() {
            if (MudAudio.isMuted()) { log('Sons desativados!', 'warn'); return; }
            const cur = MudAudio.getVolume();
            if (cur >= 100) { log('Volume j√° est√° em 100.', 'warn'); return; }
            const nv = Math.min(100, cur + 5);
            MudAudio.volume(nv);
            $('masterVol').value = nv;
            $('masterVolLabel').textContent = nv;
            log(`volume ‚Üí ${nv}`);
            refreshState();
        }

        function doSlideVol() {
            const id = parseInt($('slideVolId').value);
            const target = parseInt($('slideVolTarget').value);
            const ms = parseInt($('slideVolMs').value);
            MudAudio.slideVol(target, id, ms);
            log(`slideVol(target=${target}, id=${id}, ${ms}ms)`, 'info');
        }

        // ‚îÄ‚îÄ Pan ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

        function doPan(v) {
            v = parseInt(v);
            $('defaultPanLabel').textContent = v;
            MudAudio.pan(v);
        }

        function doPanId() {
            const id = parseInt($('panId').value);
            const val = parseInt($('panVal').value);
            MudAudio.pan(val, id);
            log(`pan(${val}, id=${id})`);
        }

        function doSlidePan() {
            const id = parseInt($('slidePanId').value);
            const target = parseInt($('slidePanTarget').value);
            const ms = parseInt($('slidePanMs').value);
            MudAudio.slidePan(target, id, ms);
            log(`slidePan(target=${target}, id=${id}, ${ms}ms)`, 'info');
        }

        // ‚îÄ‚îÄ Fadeout ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

        function doFadeout() {
            const id = parseInt($('fadeId').value);
            const ms = parseInt($('fadeMs').value);
            MudAudio.fadeout(id, ms);
            log(`fadeout(id=${id}, ${ms}ms)`, 'info');
        }

        // ‚îÄ‚îÄ Pitch ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

        function doPitch() {
            const id = parseInt($('pitchId').value);
            const val = parseInt($('pitchVal').value);
            MudAudio.pitch(val, id);
            log(`pitch(${val}, id=${id})`);
        }

        function doSlidePitch() {
            const id = parseInt($('slidePitchId').value);
            const target = parseInt($('slidePitchTarget').value);
            const ms = parseInt($('slidePitchMs').value);
            MudAudio.slidePitch(target, id, ms);
            log(`slidePitch(target=${target}, id=${id}, ${ms}ms)`, 'info');
        }

        // ‚îÄ‚îÄ Keyboard shortcut (Ctrl+F12 como no plugin original) ‚îÄ‚îÄ
        document.addEventListener('keydown', e => {
            if (e.ctrlKey && e.key === 'F12') {
                e.preventDefault();
                doToggleMute();
            }
        });

        // refresh peri√≥dico
        setInterval(refreshState, 2000);
        refreshState();

        log('Audio engine carregado. Clique em um bot√£o para iniciar o AudioContext.', 'info');

        // ‚îÄ‚îÄ Registry ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

        async function doLoadRegistry() {
            try {
                const reg = await MudAudio.loadRegistry();
                const names = Object.keys(reg);
                const sel = $('registrySelect');
                sel.innerHTML = '';
                names.forEach(n => {
                    const opt = document.createElement('option');
                    opt.value = n;
                    opt.textContent = `${n}  ‚Üí  ${reg[n]}`;
                    sel.appendChild(opt);
                });
                $('registryStatus').textContent = `‚úì ${names.length} sons mapeados`;
                $('registryStatus').style.color = '#16c79a';
                log(`Registry carregado: ${names.length} entradas`, 'ok');
                refreshState();
            } catch (e) { log(e.message, 'err'); }
        }

        function _getRegistryName() {
            return $('registryName').value.trim() || $('registrySelect').value;
        }

        async function doPlayByName() {
            const name = _getRegistryName();
            if (!name) { log('Informe um nome do registry', 'warn'); return; }
            try {
                const id = await MudAudio.playByName(name);
                log(`playByName("${name}") ‚Üí id=${id}`);
                refreshState();
            } catch (e) { log(e.message, 'err'); }
        }

        async function doPlayByNameLooped() {
            const name = _getRegistryName();
            if (!name) { log('Informe um nome do registry', 'warn'); return; }
            try {
                const id = await MudAudio.playByName(name, 1);
                log(`playByName("${name}", loop) ‚Üí id=${id}`);
                refreshState();
            } catch (e) { log(e.message, 'err'); }
        }

        async function doResolve() {
            const name = _getRegistryName();
            if (!name) { log('Informe um nome do registry', 'warn'); return; }
            try {
                const url = await MudAudio.resolve(name);
                log(`resolve("${name}") ‚Üí ${url}`, 'info');
            } catch (e) { log(e.message, 'err'); }
        }
    </script>

</body>

</html>